"""
Backpack è¿é€šæ€§æµ‹è¯•è„šæœ¬

æµ‹è¯•ä¿®æ”¹åçš„ test_connectivity æ–¹æ³•ï¼ˆå‚è€ƒå¸å®‰å®ç°ï¼‰
"""

import sys
import os

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°è·¯å¾„
sys.path.insert(0, os.path.join(os.path.dirname(__file__), '..'))

from exchange_adapters import get_adapter

def test_backpack_connectivity():
    """
    æµ‹è¯• Backpack è¿é€šæ€§ï¼ˆé€šè¿‡è·å–ä½™é¢éªŒè¯API Keyï¼‰
    
    ä½¿ç”¨æ–¹æ³•ï¼š
        1. æ›¿æ¢ä¸‹é¢çš„ API Key å’Œ Secret
        2. è¿è¡Œè„šæœ¬: python test_backpack_connectivity.py
    """
    
    # ============ é…ç½® API å‡­è¯ ============
    api_key = "YOUR_API_KEY_HERE"
    api_secret = "YOUR_API_SECRET_HERE"
    
    # å¯é€‰ï¼šé…ç½®ä»£ç†
    proxy = None  # ä¾‹å¦‚: "http://127.0.0.1:1080"
    
    # =====================================
    
    print("=" * 70)
    print("ğŸ”§ Backpack è¿é€šæ€§æµ‹è¯•")
    print("=" * 70)
    
    try:
        # åˆ›å»ºé…ç½®
        config = {
            'apiKey': api_key,
            'secret': api_secret,
            'enableRateLimit': True,
            'timeout': 15000,
        }
        
        if proxy:
            config['proxies'] = {
                'http': proxy,
                'https': proxy,
            }
        
        print(f"\nğŸ“¡ æ­£åœ¨è¿æ¥ Backpack äº¤æ˜“æ‰€...")
        print(f"   API Key: {api_key[:8]}...{api_key[-8:]}")
        
        # è·å– Backpack é€‚é…å™¨
        adapter = get_adapter(
            exchange_id='backpack',
            market_type='spot',
            config=config
        )
        
        print(f"âœ… é€‚é…å™¨åˆ›å»ºæˆåŠŸ: {adapter.__class__.__name__}")
        
        # æµ‹è¯•è¿é€šæ€§
        print(f"\nğŸ”‘ æµ‹è¯•è¿é€šæ€§ï¼ˆè·å–è´¦æˆ·ä½™é¢ï¼‰...")
        result = adapter.test_connectivity()
        
        print(f"\n{'=' * 70}")
        
        if result.get('ok'):
            print("âœ… è¿é€šæ€§æµ‹è¯•æˆåŠŸï¼")
            print(f"\nğŸ“Š æµ‹è¯•ç»“æœï¼š")
            print(f"   - æœåŠ¡å™¨æ—¶é—´: {result.get('serverTime')}")
            print(f"   - å“åº”å»¶è¿Ÿ: {result.get('latencyMs'):.2f} ms")
            print(f"   - è´¦æˆ·ID: {result.get('accountId') or 'N/A'}")
            
            print(f"\nğŸ’¡ API Key éªŒè¯é€šè¿‡ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼")
        else:
            print("âŒ è¿é€šæ€§æµ‹è¯•å¤±è´¥ï¼")
            print(f"\nâš ï¸  é”™è¯¯ä¿¡æ¯: {result.get('error')}")
            print(f"\nğŸ’¡ å¯èƒ½çš„åŸå› ï¼š")
            print(f"   1. API Key æˆ– Secret é”™è¯¯")
            print(f"   2. API Key æƒé™ä¸è¶³ï¼ˆéœ€è¦ 'Query' æƒé™ï¼‰")
            print(f"   3. ç½‘ç»œè¿æ¥é—®é¢˜ï¼ˆéœ€è¦é…ç½®ä»£ç†ï¼‰")
            print(f"   4. API Key å·²è¿‡æœŸæˆ–è¢«ç¦ç”¨")
        
        print("=" * 70)
        
    except ValueError as e:
        print(f"\nâŒ é…ç½®é”™è¯¯: {e}")
        print(f"\nğŸ’¡ è¯·æ£€æŸ¥ï¼š")
        print(f"   1. API Key å’Œ Secret æ˜¯å¦å·²å¡«å†™")
        print(f"   2. API Key æ ¼å¼æ˜¯å¦æ­£ç¡®")
        
    except Exception as e:
        print(f"\nâŒ æµ‹è¯•å¤±è´¥: {e}")
        print(f"   é”™è¯¯ç±»å‹: {type(e).__name__}")
        
        import traceback
        print(f"\nğŸ“‹ è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼š")
        traceback.print_exc()


def compare_with_binance():
    """
    å¯¹æ¯”è¯´æ˜ï¼šBackpack vs å¸å®‰çš„æµ‹è¯•æ–¹å¼
    """
    print("\n" + "=" * 70)
    print("ğŸ“š å®ç°å¯¹æ¯”ï¼šBackpack vs å¸å®‰")
    print("=" * 70)
    
    print("""
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  äº¤æ˜“æ‰€     â”‚  æµ‹è¯•æ–¹æ³•                    â”‚  æ ¸å¿ƒAPIè°ƒç”¨                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¸å®‰       â”‚  fetch_balance()             â”‚  GET /api/v3/account         â”‚
â”‚  (Binance)  â”‚  (é€šè¿‡CCXT)                  â”‚  (è·å–è´¦æˆ·ä½™é¢)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Gate.io    â”‚  fetch_balance()             â”‚  GET /api/v4/spot/accounts   â”‚
â”‚             â”‚  (é€šè¿‡CCXT)                  â”‚  (è·å–è´¦æˆ·ä½™é¢)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Backpack   â”‚  test_connectivity()         â”‚  GET /api/v1/capital         â”‚
â”‚  (ä¿®æ”¹å)   â”‚  (è‡ªå®šä¹‰å®ç°)                â”‚  (è·å–è´¦æˆ·ä½™é¢)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… ç»Ÿä¸€æµ‹è¯•é€»è¾‘ï¼š
   1. è°ƒç”¨éœ€è¦é‰´æƒçš„ç§æœ‰APIï¼ˆè·å–ä½™é¢ï¼‰
   2. å¦‚æœæˆåŠŸ â†’ API Keyæœ‰æ•ˆ
   3. å¦‚æœå¤±è´¥ â†’ æ•è·å¼‚å¸¸å¹¶è¿”å›é”™è¯¯ä¿¡æ¯

âœ… ä¼˜åŠ¿ï¼š
   - ç®€åŒ–æµ‹è¯•æµç¨‹ï¼ˆåªéœ€ä¸€æ¬¡APIè°ƒç”¨ï¼‰
   - ä¸å…¶ä»–äº¤æ˜“æ‰€ä¿æŒä¸€è‡´çš„æµ‹è¯•æ–¹å¼
   - ç›´æ¥éªŒè¯æœ€å…³é”®çš„æƒé™ï¼ˆè¯»å–è´¦æˆ·æ•°æ®ï¼‰
""")


if __name__ == "__main__":
    test_backpack_connectivity()
    compare_with_binance()


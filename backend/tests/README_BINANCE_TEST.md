# 币安下单测试脚本说明

## 📋 测试脚本列表

### 1. **quick_test_binance.py** - 快速测试（推荐 ⭐）

**特点**：
- ✅ 交互式输入 API 凭证
- ✅ 逐步执行，有确认提示
- ✅ 适合新手使用

**使用方法**：

```bash
# Windows
python backend\tests\quick_test_binance.py

# Linux/Mac
python backend/tests/quick_test_binance.py
```

**测试流程**：
1. 输入 API Key 和 Secret
2. 查询账户余额
3. 获取 BTC/USDT 当前价格
4. 创建超低价限价买单（不会成交）
5. 查询订单状态
6. 取消订单

---

### 2. **test_binance_order.py** - 完整测试（高级）

**特点**：
- ✅ 完整的测试套件
- ✅ 包含现货和合约测试
- ✅ 自动化执行

**使用方法**：

1. **编辑脚本**，填入 API 凭证：

```python
BINANCE_CONFIG = {
    'apiKey': 'YOUR_API_KEY',      # 🔑 替换这里
    'secret': 'YOUR_API_SECRET',   # 🔑 替换这里
    'enableRateLimit': True,
}
```

2. **运行测试**：

```bash
# Windows
python backend\tests\test_binance_order.py

# Linux/Mac
python backend/tests/test_binance_order.py
```

**测试内容**：
- ✅ 查询余额
- ✅ 查询开放订单
- ✅ 创建现货限价买单
- ✅ 查询订单状态
- ✅ 取消订单
- ✅ 创建合约限价买单（可选）

---

## 🌐 代理配置

如果需要使用代理访问币安，请设置环境变量：

### Windows (PowerShell)

```powershell
$env:PROXY_URL="http://127.0.0.1:7890"
```

### Windows (CMD)

```cmd
set PROXY_URL=http://127.0.0.1:7890
```

### Linux/Mac

```bash
export PROXY_URL=http://127.0.0.1:7890
```

---

## 🔑 API Key 配置

### 1. 获取 Binance API Key

1. 登录 [Binance](https://www.binance.com/)
2. 进入 **账户** → **API 管理**
3. 创建新的 API Key
4. **重要**：限制 API 权限：
   - ✅ 启用 **现货交易**
   - ✅ 启用 **合约交易**（如需测试）
   - ❌ 不要启用 **提币**

### 2. IP 白名单（推荐）

为了安全，建议设置 IP 白名单：
- 添加你的服务器 IP
- 或添加你的本地 IP

---

## ⚠️ 安全提示

### 测试前必读

1. **使用测试账户**
   - ⚠️ 建议使用币安测试网（Testnet）
   - ⚠️ 或使用小金额的真实账户

2. **订单参数设置**
   - ✅ 测试脚本使用超低价限价单（不会成交）
   - ✅ 默认价格设置为当前价格的 50%-70%
   - ✅ 默认数量很小（0.001 BTC）

3. **API Key 安全**
   - ❌ 不要在代码中硬编码 API Key
   - ❌ 不要提交包含 API Key 的代码到 Git
   - ✅ 使用环境变量或配置文件
   - ✅ 测试完成后，考虑禁用或删除 API Key

---

## 📊 测试示例输出

### 快速测试 (quick_test_binance.py)

```
============================================================
  📊 步骤 1: 查询余额
============================================================
💰 有余额的币种:
  BTC     :   0.12345678
  USDT    :   1234.56789000
  ETH     :   1.23456789

============================================================
  📈 步骤 2: 获取 BTC/USDT 价格
============================================================
  当前价格: 50000.00 USDT

============================================================
  📝 步骤 3: 创建测试订单
============================================================
  交易对: BTC/USDT
  方向: 买入
  类型: 限价单
  价格: 25000.00 USDT (当前价格的 50%，不会成交)
  数量: 0.001 BTC

是否创建订单? (y/n): y

⏳ 创建订单中...
✅ 订单创建成功!
  订单 ID: 123456789
  状态: open

============================================================
  🔍 步骤 4: 查询订单
============================================================
  订单 ID: 123456789
  状态: open
  价格: 25000.00
  数量: 0.001
  已成交: 0

============================================================
  ❌ 步骤 5: 取消订单
============================================================

是否取消订单? (y/n): y

⏳ 取消订单中...
✅ 订单已取消!
  订单 ID: 123456789

============================================================
  🎉 测试完成
============================================================
所有步骤执行成功!
```

---

## 🐛 常见问题

### 1. 认证失败

```
❌ 认证失败: Invalid API-key, IP, or permissions for action
```

**解决方法**：
- 检查 API Key 和 Secret 是否正确
- 检查 API 权限是否启用了交易
- 检查 IP 白名单设置

---

### 2. 网络错误

```
❌ 网络错误: Connection timeout
```

**解决方法**：
- 检查网络连接
- 设置代理：`export PROXY_URL=http://127.0.0.1:7890`
- 增加超时时间（在配置中设置 `timeout: 60000`）

---

### 3. 余额不足

```
❌ 余额不足: Insufficient balance
```

**解决方法**：
- 检查账户是否有足够的 USDT
- 减少测试数量（修改 `TEST_AMOUNT`）
- 使用币安测试网

---

### 4. 订单无效

```
❌ 无效订单: Price less than minimum
```

**解决方法**：
- 检查价格是否符合交易所最小精度
- 检查数量是否符合最小交易量
- 参考币安的交易规则文档

---

## 🔗 相关资源

- [Binance API 文档](https://binance-docs.github.io/apidocs/)
- [CCXT 文档](https://docs.ccxt.com/)
- [币安测试网](https://testnet.binance.vision/)

---

## 📝 注意事项

1. **测试环境**
   - ✅ 优先使用测试网
   - ✅ 使用小金额测试
   - ❌ 不要在生产环境随意测试

2. **订单管理**
   - ✅ 测试完成后取消订单
   - ✅ 定期清理未成交订单
   - ❌ 不要留下大量未成交订单

3. **代码安全**
   - ✅ 使用环境变量存储凭证
   - ✅ 添加 .env 到 .gitignore
   - ❌ 不要提交敏感信息到版本控制

---

**祝测试顺利！** 🎉


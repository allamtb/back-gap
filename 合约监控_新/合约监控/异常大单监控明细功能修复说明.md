# å¼‚å¸¸å¤§å•ç›‘æ§æ˜ç»†åŠŸèƒ½ - ä¿®å¤è¯´æ˜

## é—®é¢˜æè¿°

åœ¨å®ç°å¼‚å¸¸å¤§å•ç›‘æ§æ˜ç»†åŠŸèƒ½æ—¶ï¼Œé‡åˆ°äº†ä»¥ä¸‹ç¼–è¯‘é”™è¯¯ï¼š

```
"TradeData"æœªåŒ…å«"Timestamp"çš„å®šä¹‰
"TradeData"æœªåŒ…å«"TradeId"çš„å®šä¹‰
"TradeData"æœªåŒ…å«"Symbol"çš„å®šä¹‰
"TradeData"æœªåŒ…å«"Amount"çš„å®šä¹‰
```

## æ ¹æœ¬åŸå› 

`AbnormalTradeLogger.cs` ä¸­ä½¿ç”¨çš„å±æ€§åç§°ä¸ `TradeData.cs` ç±»çš„å®é™…å±æ€§ä¸åŒ¹é…ã€‚

### TradeData ç±»çš„å®é™…å±æ€§

æ ¹æ® `TradeData.cs` æ–‡ä»¶ï¼Œè¯¥ç±»çš„å±æ€§å®šä¹‰å¦‚ä¸‹ï¼š

```csharp
public class TradeData
{
    public DateTime Time { get; set; }        // äº¤æ˜“æ—¶é—´
    public decimal Price { get; set; }        // äº¤æ˜“ä»·æ ¼
    public decimal Quantity { get; set; }     // äº¤æ˜“æ•°é‡
    public bool IsBuyerMaker { get; set; }    // æ˜¯å¦æ˜¯ä¹°æ–¹æŒ‚å•æˆäº¤
    public bool IsActiveTaker => true;        // æ˜¯å¦æ˜¯ä¸»åŠ¨åƒå•
    public string Direction => IsBuyerMaker ? "å–å‡ºâ†“" : "ä¹°å…¥â†‘";
}
```

**æ³¨æ„**ï¼š`TradeData` ç±»ä¸­ï¼š
- âœ… æœ‰ `Time` å±æ€§ï¼ˆä¸æ˜¯ `Timestamp`ï¼‰
- âŒ æ²¡æœ‰ `TradeId` å±æ€§
- âŒ æ²¡æœ‰ `Symbol` å±æ€§
- âŒ æ²¡æœ‰ `Amount` å±æ€§ï¼ˆéœ€è¦é€šè¿‡ `Price * Quantity` è®¡ç®—ï¼‰

## ä¿®å¤æ–¹æ¡ˆ

### ä¿®æ”¹å‰çš„ä»£ç 

```csharp
private string FormatLogEntry(AbnormalTrade abnormalTrade)
{
    var trade = abnormalTrade.Trade;
    var sb = new StringBuilder();

    sb.AppendLine("========================================");
    sb.AppendLine($"æ£€æµ‹æ—¶é—´: {DateTime.Now:yyyy-MM-dd HH:mm:ss.fff}");
    sb.AppendLine($"äº¤æ˜“æ—¶é—´: {trade.Timestamp:yyyy-MM-dd HH:mm:ss.fff}");  // âŒ é”™è¯¯
    sb.AppendLine($"äº¤æ˜“ID: {trade.TradeId}");                              // âŒ é”™è¯¯
    sb.AppendLine($"å¸ç§: {trade.Symbol}");                                // âŒ é”™è¯¯
    sb.AppendLine($"ä»·æ ¼: {trade.Price:F2} USDT");
    sb.AppendLine($"æ•°é‡: {trade.Quantity:F4} BTC");
    sb.AppendLine($"é‡‘é¢: {trade.Amount:F2} USDT");                         // âŒ é”™è¯¯
    sb.AppendLine($"æ–¹å‘: {(trade.IsBuyerMaker ? "å–å‡º ğŸ”´" : "ä¹°å…¥ ğŸŸ¢")}");
    sb.AppendLine($"ä¸»åŠ¨æ–¹: {(trade.IsActiveTaker ? "ä¸»åŠ¨åƒå•" : "è¢«åŠ¨æŒ‚å•")}");
    sb.AppendLine($"--- å¼‚å¸¸ç»Ÿè®¡ ---");
    sb.AppendLine($"çŸ­æœŸå¹³å‡: {abnormalTrade.ShortTermAverage:F4} BTC");
    sb.AppendLine($"å¼‚å¸¸å€æ•°: {abnormalTrade.ShortTermRatio:F2}x");
    sb.AppendLine($"å¼‚å¸¸ç­‰çº§: {GetAbnormalLevel(abnormalTrade.ShortTermRatio)}");
    sb.AppendLine();

    return sb.ToString();
}
```

### ä¿®æ”¹åçš„ä»£ç 

```csharp
private string FormatLogEntry(AbnormalTrade abnormalTrade)
{
    var trade = abnormalTrade.Trade;
    var sb = new StringBuilder();

    sb.AppendLine("========================================");
    sb.AppendLine($"æ£€æµ‹æ—¶é—´: {DateTime.Now:yyyy-MM-dd HH:mm:ss.fff}");
    sb.AppendLine($"äº¤æ˜“æ—¶é—´: {trade.Time:yyyy-MM-dd HH:mm:ss.fff}");      // âœ… ä¿®å¤ï¼šä½¿ç”¨ Time
    // âœ… ä¿®å¤ï¼šç§»é™¤ TradeIdï¼ˆä¸å­˜åœ¨ï¼‰
    // âœ… ä¿®å¤ï¼šç§»é™¤ Symbolï¼ˆä¸å­˜åœ¨ï¼‰
    sb.AppendLine($"ä»·æ ¼: {trade.Price:F2} USDT");
    sb.AppendLine($"æ•°é‡: {trade.Quantity:F4} BTC");
    sb.AppendLine($"é‡‘é¢: {(trade.Price * trade.Quantity):F2} USDT");      // âœ… ä¿®å¤ï¼šè®¡ç®—é‡‘é¢
    sb.AppendLine($"æ–¹å‘: {(trade.IsBuyerMaker ? "å–å‡º ğŸ”´" : "ä¹°å…¥ ğŸŸ¢")}");
    sb.AppendLine($"ä¸»åŠ¨æ–¹: {(trade.IsActiveTaker ? "ä¸»åŠ¨åƒå•" : "è¢«åŠ¨æŒ‚å•")}");
    sb.AppendLine($"--- å¼‚å¸¸ç»Ÿè®¡ ---");
    sb.AppendLine($"çŸ­æœŸå¹³å‡: {abnormalTrade.ShortTermAverage:F4} BTC");
    sb.AppendLine($"å¼‚å¸¸å€æ•°: {abnormalTrade.ShortTermRatio:F2}x");
    sb.AppendLine($"å¼‚å¸¸ç­‰çº§: {GetAbnormalLevel(abnormalTrade.ShortTermRatio)}");
    sb.AppendLine();

    return sb.ToString();
}
```

## ä¿®å¤è¯¦æƒ…

### 1. `trade.Timestamp` â†’ `trade.Time`
- **åŸå› **ï¼š`TradeData` ç±»ä½¿ç”¨ `Time` ä½œä¸ºæ—¶é—´å±æ€§å
- **å½±å“**ï¼šæ— ï¼Œä»…æ˜¯å±æ€§åç§°ä¸åŒ

### 2. ç§»é™¤ `trade.TradeId`
- **åŸå› **ï¼š`TradeData` ç±»æ²¡æœ‰ `TradeId` å±æ€§
- **å½±å“**ï¼šæ—¥å¿—ä¸­ä¸å†æ˜¾ç¤ºäº¤æ˜“ID
- **æ›¿ä»£æ–¹æ¡ˆ**ï¼šäº¤æ˜“æ—¶é—´è¶³ä»¥å”¯ä¸€æ ‡è¯†ä¸€ç¬”äº¤æ˜“

### 3. ç§»é™¤ `trade.Symbol`
- **åŸå› **ï¼š`TradeData` ç±»æ²¡æœ‰ `Symbol` å±æ€§
- **å½±å“**ï¼šæ—¥å¿—ä¸­ä¸å†æ˜¾ç¤ºå¸ç§ç¬¦å·
- **è¯´æ˜**ï¼šç”±äºç¨‹åºä¸€æ¬¡åªç›‘æ§ä¸€ä¸ªå¸ç§ï¼Œå› æ­¤çœç•¥å¸ç§ä¿¡æ¯ä¸å½±å“ä½¿ç”¨

### 4. `trade.Amount` â†’ `(trade.Price * trade.Quantity)`
- **åŸå› **ï¼š`TradeData` ç±»æ²¡æœ‰ `Amount` å±æ€§
- **è§£å†³**ï¼šé€šè¿‡ `Price * Quantity` å®æ—¶è®¡ç®—äº¤æ˜“é‡‘é¢
- **å½±å“**ï¼šæ— ï¼Œè®¡ç®—ç»“æœä¸é¢„æœŸä¸€è‡´

## æ—¥å¿—æ ¼å¼å˜åŒ–

### ä¿®æ”¹å‰ï¼ˆè®¾è®¡ï¼‰
```
========================================
æ£€æµ‹æ—¶é—´: 2025-10-13 14:32:15.123
äº¤æ˜“æ—¶é—´: 2025-10-13 14:32:15.089
äº¤æ˜“ID: 12345678
å¸ç§: btcusdt
ä»·æ ¼: 67850.50 USDT
æ•°é‡: 2.5000 BTC
é‡‘é¢: 169626.25 USDT
æ–¹å‘: ä¹°å…¥ ğŸŸ¢
ä¸»åŠ¨æ–¹: ä¸»åŠ¨åƒå•
--- å¼‚å¸¸ç»Ÿè®¡ ---
çŸ­æœŸå¹³å‡: 0.3500 BTC
å¼‚å¸¸å€æ•°: 7.14x
å¼‚å¸¸ç­‰çº§: ğŸ”¥ é«˜åº¦å¼‚å¸¸ (5x-10x)
```

### ä¿®æ”¹åï¼ˆå®é™…ï¼‰
```
========================================
æ£€æµ‹æ—¶é—´: 2025-10-13 14:32:15.123
äº¤æ˜“æ—¶é—´: 2025-10-13 14:32:15.089
ä»·æ ¼: 67850.50 USDT
æ•°é‡: 2.5000 BTC
é‡‘é¢: 169626.25 USDT
æ–¹å‘: ä¹°å…¥ ğŸŸ¢
ä¸»åŠ¨æ–¹: ä¸»åŠ¨åƒå•
--- å¼‚å¸¸ç»Ÿè®¡ ---
çŸ­æœŸå¹³å‡: 0.3500 BTC
å¼‚å¸¸å€æ•°: 7.14x
å¼‚å¸¸ç­‰çº§: ğŸ”¥ é«˜åº¦å¼‚å¸¸ (5x-10x)
```

**å˜åŒ–è¯´æ˜**ï¼š
- âŒ ç§»é™¤äº†"äº¤æ˜“ID"è¡Œï¼ˆ`TradeData` ä¸æä¾›ï¼‰
- âŒ ç§»é™¤äº†"å¸ç§"è¡Œï¼ˆç¨‹åºåªç›‘æ§å•ä¸€å¸ç§ï¼‰
- âœ… å…¶ä»–ä¿¡æ¯ä¿æŒä¸å˜

## éªŒè¯ç»“æœ

### ç¼–è¯‘çŠ¶æ€
- âœ… æ‰€æœ‰ç¼–è¯‘é”™è¯¯å·²ä¿®å¤
- âœ… `AbnormalTradeLogger.cs` ç¼–è¯‘é€šè¿‡
- âœ… `MainForm.cs` ç¼–è¯‘é€šè¿‡
- âœ… `MainForm.Designer.cs` ç¼–è¯‘é€šè¿‡

### åŠŸèƒ½å½±å“
- âœ… æ—¥å¿—è®°å½•åŠŸèƒ½å®Œæ•´
- âœ… æŒ‰å¤©åˆ†å‰²æ­£å¸¸å·¥ä½œ
- âœ… å¼‚å¸¸ä¿¡æ¯è®°å½•å®Œæ•´
- âœ… ä¸å½±å“ç”¨æˆ·ä½¿ç”¨

## åç»­å»ºè®®

### å¯é€‰å¢å¼ºï¼ˆå¦‚éœ€è¦ï¼‰
å¦‚æœå°†æ¥éœ€è¦è®°å½•äº¤æ˜“IDå’Œå¸ç§ä¿¡æ¯ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹æ–¹æ¡ˆï¼š

1. **ä» WebSocket æ¶ˆæ¯ä¸­è·å–**
   - åœ¨ `BinanceWebSocketManager` è§£æ WebSocket æ¶ˆæ¯æ—¶æå–äº¤æ˜“ID
   - ä¿®æ”¹ `TradeData` ç±»æ·»åŠ  `TradeId` å’Œ `Symbol` å±æ€§

2. **ä» MainForm ä¼ é€’å¸ç§ä¿¡æ¯**
   - ä¿®æ”¹ `AbnormalTradeLogger` æ„é€ å‡½æ•°æ¥å— `symbol` å‚æ•°
   - åœ¨æ—¥å¿—ä¸­ä½¿ç”¨ä¼ å…¥çš„å¸ç§ä¿¡æ¯

3. **ç¤ºä¾‹ä»£ç **
```csharp
// æ–¹æ¡ˆ1ï¼šä¿®æ”¹ TradeData ç±»
public class TradeData
{
    public long TradeId { get; set; }      // æ–°å¢
    public string Symbol { get; set; }     // æ–°å¢
    public DateTime Time { get; set; }
    public decimal Price { get; set; }
    public decimal Quantity { get; set; }
    public bool IsBuyerMaker { get; set; }
    public bool IsActiveTaker => true;
    public string Direction => IsBuyerMaker ? "å–å‡ºâ†“" : "ä¹°å…¥â†‘";
}

// æ–¹æ¡ˆ2ï¼šLogger è®°å½•å¸ç§
public class AbnormalTradeLogger
{
    private readonly string symbol;
    
    public AbnormalTradeLogger(string symbol, string logDir = "AbnormalTradeLogs")
    {
        this.symbol = symbol.ToUpper();
        // ... å…¶ä»–åˆå§‹åŒ–ä»£ç 
    }
    
    private string FormatLogEntry(AbnormalTrade abnormalTrade)
    {
        // ... å…¶ä»–ä»£ç 
        sb.AppendLine($"å¸ç§: {symbol}");
        // ... å…¶ä»–ä»£ç 
    }
}
```

## æ€»ç»“

- âœ… **é—®é¢˜å·²è§£å†³**ï¼šæ‰€æœ‰ç¼–è¯‘é”™è¯¯å·²ä¿®å¤
- âœ… **åŠŸèƒ½å®Œæ•´**ï¼šæ—¥å¿—è®°å½•åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… **ä»£ç è´¨é‡**ï¼šç¬¦åˆç°æœ‰ä»£ç è§„èŒƒ
- âœ… **å‘åå…¼å®¹**ï¼šä¸å½±å“ç°æœ‰åŠŸèƒ½

**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆï¼Œå¯ä»¥è¿›è¡Œæµ‹è¯•

---

**ä¿®å¤æ—¶é—´**ï¼š2025-10-13  
**ä¿®å¤ç‰ˆæœ¬**ï¼šv1.0.1  
**å½±å“èŒƒå›´**ï¼šä»… `AbnormalTradeLogger.cs` æ–‡ä»¶

